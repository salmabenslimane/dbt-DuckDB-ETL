version: 2

models:
  - name: stg_playstore_apps
    description: >
      Cleaned and standardized apps metadata from the Google Play Store.
      One row per app. Surrogate key is md5(app_id).
    columns:
      - name: app_sk
        description: Surrogate key — md5 hash of app_id
        tests:
          - not_null
          - unique
      - name: app_id
        description: Natural key — Google Play Store package name (e.g. com.otter.ai)
        tests:
          - not_null
          - unique
      - name: app_name
        tests:
          - not_null
      - name: score
        description: Average user rating (0.0 to 5.0)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 5
      - name: price
        tests:
          - not_null

  - name: stg_playstore_reviews
    description: >
      Cleaned and standardized user reviews from the Google Play Store.
      One row per review. Surrogate key is md5(review_id).
    columns:
      - name: review_sk
        description: Surrogate key — md5 hash of review_id
        tests:
          - not_null
          - unique
      - name: review_id
        description: Natural key — unique review identifier from the Play Store API
        tests:
          - not_null
          - unique
      - name: app_id
        description: Foreign key to stg_playstore_apps.app_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_playstore_apps')
              field: app_id
      - name: score
        description: User rating (1 to 5, out-of-range values filtered at staging)
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: reviewed_at
        description: Timestamp of the review — must not be null (malformed dates filtered)
        tests:
          - not_null
      - name: date_key
        description: Integer date key in YYYYMMDD format for joining to dim_date
        tests:
          - not_null
